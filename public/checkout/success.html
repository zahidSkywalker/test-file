<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Successful - ResellerHub</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="/css/output.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="/" class="flex items-center space-x-2">
                        <div class="w-10 h-10 bg-gradient-to-r from-primary-500 to-primary-700 rounded-lg flex items-center justify-center">
                            <i class="fas fa-recycle text-white text-xl"></i>
                        </div>
                        <span class="font-display font-bold text-xl text-gray-900">ResellerHub</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Success Content -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="text-center mb-12">
            <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6" id="successIcon">
                <i class="fas fa-check text-green-600 text-4xl"></i>
            </div>
            <h1 class="text-4xl font-display font-bold text-gray-900 mb-4" id="successTitle">Order Successful!</h1>
            <p class="text-xl text-gray-600 mb-2" id="successMessage">Thank you for your purchase. Your order has been placed successfully.</p>
            <p class="text-lg text-gray-500" id="orderNumber">Order #: Loading...</p>
        </div>

        <!-- Order Details -->
        <div class="bg-white rounded-lg shadow-md p-8 mb-8">
            <h2 class="text-2xl font-semibold text-gray-900 mb-6">Order Details</h2>
            
            <div id="orderDetailsContent" class="space-y-6">
                <!-- Order details will be loaded here -->
            </div>
        </div>

        <!-- Next Steps -->
        <div class="bg-white rounded-lg shadow-md p-8 mb-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">What's Next?</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-envelope text-blue-600 text-2xl"></i>
                    </div>
                    <h4 class="font-semibold mb-2">Order Confirmation</h4>
                    <p class="text-sm text-gray-600">You'll receive an email confirmation with your order details shortly.</p>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-box text-yellow-600 text-2xl"></i>
                    </div>
                    <h4 class="font-semibold mb-2">Processing</h4>
                    <p class="text-sm text-gray-600">Your order will be processed and prepared for shipping within 1-2 business days.</p>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-truck text-green-600 text-2xl"></i>
                    </div>
                    <h4 class="font-semibold mb-2">Delivery</h4>
                    <p class="text-sm text-gray-600">Track your package and expect delivery within 3-5 business days.</p>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a href="/orders" class="btn-primary text-center">
                <i class="fas fa-list mr-2"></i>
                View My Orders
            </a>
            <a href="/products" class="btn-secondary text-center">
                <i class="fas fa-search mr-2"></i>
                Continue Shopping
            </a>
            <a href="/" class="btn-secondary text-center">
                <i class="fas fa-home mr-2"></i>
                Back to Home
            </a>
        </div>
    </div>

    <script src="/js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('order');

            if (orderId) {
                await loadOrderDetails(orderId);
            } else {
                showGenericSuccess();
            }

            // Animate success page
            animateSuccessPage();
        });

        async function loadOrderDetails(orderId) {
            try {
                const response = await apiRequest(`/api/orders/${orderId}`);
                
                if (response && response.ok) {
                    const order = await response.json();
                    displayOrderDetails(order);
                } else {
                    throw new Error('Failed to load order details');
                }
            } catch (error) {
                console.error('Error loading order details:', error);
                showGenericSuccess();
            }
        }

        function displayOrderDetails(order) {
            document.getElementById('orderNumber').textContent = `Order #: ${order.orderNumber}`;
            
            const content = document.getElementById('orderDetailsContent');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">Order Items</h4>
                        <div class="space-y-3">
                            ${order.items.map(item => `
                                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                    <img src="${item.product.images?.[0]?.url || '/images/placeholder.svg'}" 
                                         alt="${item.product.title}" 
                                         class="w-12 h-12 object-cover rounded">
                                    <div class="flex-1">
                                        <p class="font-medium text-sm">${item.product.title}</p>
                                        <p class="text-xs text-gray-600">Qty: ${item.quantity} Ã— $${item.price}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium text-sm">$${(item.price * item.quantity).toFixed(2)}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">Order Summary</h4>
                        <div class="bg-gray-50 rounded-lg p-4 space-y-2">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Subtotal</span>
                                <span>$${order.totals.subtotal.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Shipping</span>
                                <span>$${order.totals.shipping.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Tax</span>
                                <span>$${order.totals.tax.toFixed(2)}</span>
                            </div>
                            <hr>
                            <div class="flex justify-between font-semibold text-lg">
                                <span>Total</span>
                                <span class="text-primary-600">$${order.totals.total.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">Shipping Address</h4>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="font-medium">${order.shippingAddress.name}</p>
                            <p class="text-sm text-gray-600">${order.shippingAddress.street}</p>
                            <p class="text-sm text-gray-600">${order.shippingAddress.city}, ${order.shippingAddress.state} ${order.shippingAddress.zipCode}</p>
                            <p class="text-sm text-gray-600">${order.shippingAddress.country}</p>
                            ${order.shippingAddress.phone ? `<p class="text-sm text-gray-600">Phone: ${order.shippingAddress.phone}</p>` : ''}
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">Payment Information</h4>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="font-medium capitalize">${order.payment.method.replace('-', ' ')}</p>
                            <p class="text-sm text-gray-600">Status: <span class="badge badge-success">${order.payment.status}</span></p>
                            ${order.payment.transactionId ? `<p class="text-sm text-gray-600">Transaction ID: ${order.payment.transactionId}</p>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function showGenericSuccess() {
            document.getElementById('orderNumber').textContent = 'Order placed successfully!';
            
            const content = document.getElementById('orderDetailsContent');
            content.innerHTML = `
                <div class="text-center py-8">
                    <p class="text-gray-600">Your order has been placed and is being processed.</p>
                    <p class="text-sm text-gray-500 mt-2">You can view your order details in your account.</p>
                </div>
            `;
        }

        function animateSuccessPage() {
            if (typeof gsap !== 'undefined') {
                const tl = gsap.timeline();
                
                // Animate success icon
                tl.from('#successIcon', {
                    duration: 0.6,
                    scale: 0,
                    rotation: -180,
                    ease: 'back.out(1.7)'
                })
                .from('#successTitle', {
                    duration: 0.8,
                    y: 30,
                    opacity: 0,
                    ease: 'power2.out'
                }, '-=0.3')
                .from('#successMessage', {
                    duration: 0.8,
                    y: 20,
                    opacity: 0,
                    ease: 'power2.out'
                }, '-=0.5')
                .from('#orderNumber', {
                    duration: 0.8,
                    y: 20,
                    opacity: 0,
                    ease: 'power2.out'
                }, '-=0.7')
                .from('.bg-white.rounded-lg.shadow-md', {
                    duration: 0.8,
                    y: 30,
                    opacity: 0,
                    stagger: 0.2,
                    ease: 'power2.out'
                }, '-=0.5');
            }
        }
    </script>
</body>
</html>